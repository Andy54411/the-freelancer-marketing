# Backup current changes before running lint-staged
echo "ðŸ”’ Creating safety backup..."
git stash push -m "SAFETY_BACKUP_$(date +%Y%m%d_%H%M%S)" --include-untracked

# Run lint-staged with error handling
npx lint-staged

# If lint-staged fails, restore the backup and show helpful message
if [ $? -ne 0 ]; then
  echo "âŒ Lint-staged failed. Restoring your work..."
  git stash pop
  echo "âœ… Your changes have been restored. Fix linting issues and try again."
  echo "ðŸ’¡ Use 'git commit --no-verify' to skip linting if urgent."
  exit 1
fi

# If successful, remove the safety backup
git stash drop "stash@{0}" 2>/dev/null || true
echo "âœ… Pre-commit checks passed!"
